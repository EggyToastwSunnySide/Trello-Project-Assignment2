<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ current_board_name }}</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0079bf; margin: 0; padding: 0; color: #172b4d; display: flex; flex-direction: column; height: 100vh; }
        .navbar { background-color: rgba(0,0,0,0.25); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; color: white; flex-shrink: 0; backdrop-filter: blur(4px); }
        .board-select { padding: 6px; border-radius: 3px; border: none; background: rgba(255,255,255,0.2); color: white; cursor: pointer; }
        .board-select option { color: black; }
        .new-board-btn, .btn-nav { background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 6px 12px; border-radius: 3px; font-size: 14px; margin-left: 10px; }
        
        /* THANH TI·∫æN ƒê·ªò TO√ÄN B·∫¢NG (M·ªöI) */
        .board-stats { background: rgba(0,0,0,0.1); padding: 10px 20px; color: white; display: flex; align-items: center; gap: 15px; }
        .main-progress-bar { width: 200px; height: 10px; background: rgba(255,255,255,0.3); border-radius: 5px; overflow: hidden; }
        .main-progress-fill { height: 100%; background: #61bd4f; transition: width 0.5s; }

        .board-container { display: flex; align-items: flex-start; overflow-x: auto; padding: 20px; height: 100%; box-sizing: border-box; }
        .list { background: #ebecf0; border-radius: 3px; width: 300px; margin-right: 12px; padding: 10px; flex-shrink: 0; display: flex; flex-direction: column; max-height: 100%; }
        .list-header { font-weight: bold; padding: 8px; font-size: 14px; }
        .cards-container { overflow-y: auto; padding-right: 4px; }
        
        .card { background: white; border-radius: 3px; padding: 8px 10px; margin-bottom: 8px; box-shadow: 0 1px 0 rgba(9,30,66,.25); cursor: pointer; position: relative; }
        .card:hover { background: #f4f5f7; }
        
        .completed-card { background-color: #f8f9fa; opacity: 0.7; }
        .completed-card .card-title { text-decoration: line-through; color: #6c757d; }
        .done-badge { display: inline-block; background: #61bd4f; color: white; border-radius: 50%; width: 14px; height: 14px; text-align: center; line-height: 14px; font-size: 10px; margin-right: 6px; position: relative; top: -1px; }

        .card-actions { position: absolute; top: 4px; right: 4px; display: none; gap: 4px; }
        .card:hover .card-actions { display: flex; }
        .icon-btn { background: rgba(255,255,255,0.8); border: none; color: #6b778c; cursor: pointer; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 3px; text-decoration: none; }
        .icon-btn:hover { background: #ebecf0; color: #172b4d; }
        
        .badges { margin-top: 6px; display: flex; gap: 5px; font-size: 11px; font-weight: 600; }
        .badge { padding: 2px 6px; border-radius: 3px; color: white; }
        .priority-Urgent { background: #eb5a46; } .priority-High { background: #ff9f1a; }
        .priority-Medium { background: #f2d600; color: #333; } .priority-Low { background: #61bd4f; }
        
        .meta { color: #5e6c84; font-size: 12px; margin-top: 8px; }
        .fab-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #0079bf; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; text-decoration: none; font-size: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 1000; }
        
        /* Flash messages */
        .flash-container { padding: 10px 20px 0; }
        .alert { padding: 10px; border-radius: 4px; background: #d4edda; color: #155724; display:flex; justify-content:space-between; }
        .alert-error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="navbar">
        <div style="display:flex; align-items:center; gap:15px;">
            <span style="font-size:18px; font-weight:bold;">{{ current_board_name }}</span>
            <select class="board-select" onchange="location = this.value;">
                {% for board in all_boards %}
                    <option value="/?board_id={{ board.BoardID }}" {% if board.BoardID == current_board_id %}selected{% endif %}>{{ board.Name }}</option>
                {% endfor %}
            </select>
            <a href="/create_board" class="new-board-btn">+ Board</a>
        </div>
        <div>
            {% if user_name %}<span style="font-size:14px; margin-right:15px;">üëã {{ user_name }}</span>{% endif %}
            <a href="/logout" class="btn-nav">Logout</a>
        </div>
    </div>

    <div class="board-stats">
        <div style="font-size: 13px;">Board Progress: <strong>{{ board_progress }}%</strong></div>
        <div class="main-progress-bar">
            <div class="main-progress-fill" style="width: {{ board_progress }}%;"></div>
        </div>
    </div>

    <div class="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }}"><span>{{ message }}</span><span onclick="this.parentElement.style.display='none'" style="cursor:pointer;">√ó</span></div>
            {% endfor %}
          {% endif %}
        {% endwith %}
    </div>

    <div class="board-container">
        {% for list_name, cards in lists.items() %}
        <div class="list">
            <div class="list-header">{{ list_name }}</div>
            <div class="cards-container">
                {% for card in cards %}
                <div class="card {% if card.is_completed %}completed-card{% endif %}">
                    <div class="card-actions">
                        <a href="/edit_card/{{ card.id }}" class="icon-btn">‚úé</a>
                        <form action="/delete_card/{{ card.id }}?board_id={{ current_board_id }}" method="POST" onsubmit="return confirm('X√≥a?');" style="margin:0;">
                            <button type="submit" class="icon-btn" style="color:#c00;">√ó</button>
                        </form>
                    </div>
                    <div style="font-weight:500; padding-right:50px;">
                        {% if card.is_completed %}<span class="done-badge">‚úì</span>{% endif %}
                        {{ card.title }}
                    </div>
                    <div class="badges"><span class="badge priority-{{ card.priority }}">{{ card.priority }}</span></div>
                    <div class="meta">
                        {% if card.due_date %}üìÖ {{ card.due_date }}<br>{% endif %}
                        üë§ {{ card.assignees }}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% if list_name not in ['Completed', 'Done', 'Finished'] %}
                <a href="/add?board_id={{ current_board_id }}" class="add-card-link">
                    + Add a card
                </a>
            {% endif %}
            
        </div>
        {% endfor %}
    </div>
    <a href="/add?board_id={{ current_board_id }}" class="fab-btn">+</a>
</body>
</html>